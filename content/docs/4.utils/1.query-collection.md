---
title: queryCollection
description: queryCollection 组合式函数提供了查询和获取集合的方法。
---

## 使用方法

使用自动导入的 `queryCollection` 来查找集合中的内容。这里假设您已在 `content.config.ts` 中定义了 `docs` 集合。

如果您尚未定义任何集合，请查看[如何定义集合](/docs/collections/define#defining-collections)。

```vue [pages/[...slug\\].vue]
<script setup>
const route = useRoute()
const { data: page } = await useAsyncData(route.path, () => {
  return queryCollection('docs').path(route.path).first()
})
</script>
```

::tip
`queryCollection` 工具在 Vue 和 Nitro 中都可用。查看[服务器端使用](#server-usage)以了解如何在服务器端使用它的更多详细信息。
::

## API

### 类型

```ts
function queryCollection<T extends keyof Collections>(collection: T): CollectionQueryBuilder<Collections[T]>

interface CollectionQueryBuilder<T> {
  where(field: keyof T | string, operator: SQLOperator, value?: unknown): CollectionQueryBuilder<T>
  andWhere(groupFactory: QueryGroupFunction<T>): CollectionQueryBuilder<T>
  orWhere(groupFactory: QueryGroupFunction<T>): CollectionQueryBuilder<T>
  order(field: keyof T, direction: 'ASC' | 'DESC'): CollectionQueryBuilder<T>
  // ... 其他方法
}
```

### `queryCollection(collection: CollectionName)`

创建一个查询构建器，用于在特定集合中搜索。

- 参数:
  - `collection`: 在 `content.config.ts` 中定义的集合的键

### `path(path: string)`

搜索具有特定 `path` 的内容。（`path` 是 `page` 集合中的一个特殊字段，基于文件系统路径生成，可以用作渲染内容的路由）

- 参数:
  - `path`: 要匹配的路径字符串。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs').path(route.path).first()
})
```

### `select(...fields: keyof Collection)`

从集合中选择特定字段，以便在查询结果中返回。

- 参数:
  - `...fields`: 要从集合中选择的字段名称列表。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    .select('path', 'title', 'description')
    .first()
})
```

### `where(field: keyof Collection | string, operator: SqlOperator, value?: unknown)`

向查询添加条件，以基于特定字段过滤结果。

- 参数:
  - `field`: 要过滤的字段
  - `operator`: 用于比较的 SQL 运算符。可能的值包括：
    - `'='`: 等于
    - `'>'`: 大于
    - `'<'`: 小于
    - `'<>'`: 不等于
    - `'IN'`: 在值列表中
    - `'BETWEEN'`: 在两个值之间
    - `'NOT BETWEEN'`: 不在两个值之间
    - `'IS NULL'`: 为空
    - `'IS NOT NULL'`: 不为空
    - `'LIKE'`: 匹配模式
    - `'NOT LIKE'`: 不匹配模式
  - `value`: 要比较的值。类型取决于使用的运算符。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    .where('date', '<', '2024-04-04')
    .where('category', '=', 'news')
    .all()
})

// 生成的 SQL
// SELECT * FROM docs WHERE date < '2024-04-04' AND category = 'news'
```

### `andWhere(groupFactory: QueryGroupFunction<Collection>)`

向查询添加 AND 条件组。这允许更复杂的查询条件。

- 参数:
  - `groupFactory`: 接收查询构建器并可以添加多个条件的函数，这些条件将与 AND 一起分组

```ts
const { data } = await useAsyncData('recent-docs', () => {
  return queryCollection('docs')
    .where('published', '=', true)
    .andWhere(query => query.where('date', '>', '2024-01-01').where('category', '=', 'news'))
    .all()
})

// 生成的 SQL
// SELECT * FROM docs WHERE published = true AND (date > '2024-01-01' AND category = 'news')
```

### `orWhere(groupFactory: QueryGroupFunction<Collection>)`

向查询添加 OR 条件组。这允许替代条件。

- 参数:
  - `groupFactory`: 接收查询构建器并可以添加多个条件的函数，这些条件将与 OR 一起分组

```ts
const { data } = await useAsyncData('featured-docs', () => {
  return queryCollection('docs')
    .where('published', '=', true)
    .orWhere(query => query.where('featured', '=', true).where('priority', '>', 5))
    .all()
})

// 生成的 SQL
// SELECT * FROM docs WHERE published = true AND (featured = true OR priority > 5)
```

### `order(field: keyof Collection, direction: 'ASC' | 'DESC')`

基于特定字段对查询结果进行排序。

- 参数:
  - `field`: 要排序的字段。
  - `direction`: 排序方向，'ASC' 表示升序，'DESC' 表示降序。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    .order('date', 'DESC')
    .all()
})
```

### `limit(limit: number)`

限制查询返回的结果数量。

- 参数:
  - `limit`: 要返回的最大结果数。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    .limit(10)
    .all()
})
```

### `skip(skip: number)`

跳过查询中指定数量的结果。

- 参数:
  - `skip`: 要跳过的结果数。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    // 跳过前 5 项
    .skip(5)
    .all()
})
```

### `all()`

执行查询并返回所有匹配的结果。

- 返回: 解析为所有匹配文档数组的 Promise。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs').all()
})
```

### `first()`

执行查询并返回第一个匹配的结果。

- 返回: 解析为第一个匹配文档的 Promise，如果没有匹配的文档，则返回 `null`。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs').first()
})
```

### `count()`

根据查询计算匹配的集合条目数。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    // 计算匹配数
    .count()
})

// 返回
5 // 匹配数
```

您也可以将 `count()` 与上面定义的其他方法（如 `where()`）一起使用，以便在集合查询中应用额外的条件。

```ts
const route = useRoute()
const { data } = await useAsyncData(route.path, () => {
  return queryCollection('docs')
    .where('date', '<', '2024-04-04')
    // 计算匹配数
    .count()
})

// 返回
3 // 所提供查询的匹配数
```

## 示例

这是一个如何在 `docs` 集合中获取文档列表的完整示例。

```vue [index.vue]
<script setup lang="ts">
const { data: docs } = await useAsyncData('documents-list', () => {
  return queryCollection('docs')
    .order('date', 'DESC')
    .select('title', 'path', 'description')
    .all()
})
</script>

<template>
  <NuxtLink v-for="doc in docs" :key="doc.path" :to="doc.path">
    <h2>{{ doc.title }}</h2>
    <p>{{ doc.description }}</p>
  </NuxtLink>
</template>
```

## 服务器端使用

Nuxt Content 提供了类似的工具来在服务器端查询集合。唯一的区别是您需要将 `event` 作为第一个参数传递给 `queryCollection` 函数。

```ts [server/api/[slug\\].ts]
export default eventHandler(async (event) => {
  const { slug } = getRouterParams(event)
  const page = await queryCollection(event, 'docs').path(slug).first()
  return page
})
```

:::note
确保创建包含以下内容的 `server/tsconfig.json` 文件以避免类型错误。

```json
{
  "extends": "../.nuxt/tsconfig.server.json"
}
```
:::