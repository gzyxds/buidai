---
title: OAuth 提供商
description: 配置 OAuth 提供商并在您的生产网站和 Git 仓库之间同步内容。
navigation:
  title: 提供商
seo:
  title: Studio 的 Git 集成
  description: 配置 GitHub、GitLab 或 Google OAuth 并在您的生产网站和 Git 仓库之间同步内容。
---

::prose-note
初始 OAuth 设置完成后，同步将自动进行，无需手动操作。
::

## OAuth 提供商

Nuxt Studio 支持通过 GitHub、GitLab 和 Google OAuth 提供商进行身份验证。

### 提供商比较

| 功能                   | GitHub OAuth      | GitLab OAuth      | Google OAuth           |
| ---------------------- | ----------------- | ----------------- | ---------------------- |
| **身份验证**           | ✅                 | ✅                 | ✅                      |
| **Git 操作**           | ✅ 直接            | ✅ 直接            | ⚠️ 需要令牌            |
| **访问控制**           | OAuth 范围        | OAuth 范围        | 电子邮件白名单         |
| **管理员白名单**       | ✅ 可选            | ✅ 可选            | ⚠️ 必需                |
| **所需令牌**           | 无（仅 OAuth）    | 无（仅 OAuth）    | GitHub 或 GitLab 令牌  |

::note
您可以为同一个应用程序同时使用 Google 和另一个 Git 提供商。Google 通常用于不想创建 GitHub 或 GitLab 账户的非技术用户。
::

### GitHub

要使用 GitHub 作为您的身份验证提供商，您需要创建一个 GitHub OAuth 应用程序。

::prose-steps{level="4"}
#### 导航到 GitHub 开发者设置

转到 [GitHub 开发者设置](https://github.com/settings/developers) 并点击 **New OAuth App**

#### 配置 GitHub OAuth 应用程序

填写必填字段：

- **Application name**: 您的应用程序名称
- **Homepage URL**: `https://yourdomain.com`
- **Authorization callback URL**: `https://yourdomain.com`

  :::note
  如果您想在本地尝试 studio，请添加您的本地 URL 作为重定向 URI：`http://localhost:3000/__nuxt_studio/auth/github`
  :::

#### 复制您的 GitHub 凭据

创建 OAuth 应用后，您将收到：

- 一个 **Client ID**（立即可见）
- 一个 **Client Secret**（点击 **Generate a new client secret**）

#### 设置您的 GitHub 环境变量

将 GitHub OAuth 凭据添加到您的部署平台的环境变量或本地的 `.env` 文件中

```bash [.env]
STUDIO_GITHUB_CLIENT_ID=<your_github_client_id>
STUDIO_GITHUB_CLIENT_SECRET=<your_github_client_secret>
# 可选：授权电子邮件地址的逗号分隔列表，用于额外的访问控制
# STUDIO_GITHUB_MODERATORS=admin@example.com,editor@example.com
```
::

### GitLab

要使用 GitLab 作为您的身份验证提供商，您需要创建一个 GitLab OAuth 应用程序。

::prose-steps{level="4"}
#### 导航到 GitLab 应用程序

转到您的 GitLab [用户设置 → 应用程序](https://gitlab.com/-/user_settings/applications)（或您的组/组织设置）并创建一个 **新应用程序**。

#### 配置 GitLab OAuth 应用程序

填写必填字段：

- **Application name**: 您的应用程序名称
- **Redirect URI**: `https://yourdomain.com/__nuxt_studio/auth/gitlab`
- **Scopes**: 选择 `api`（发布所需）

  :::note
  如果您想在本地尝试 studio，请添加您的本地 URL 作为重定向 URI：`http://localhost:3000/__nuxt_studio/auth/gitlab`
  :::

#### 复制您的 GitLab 凭据

创建 OAuth 应用程序后，您将收到：

- 一个 **Application ID**（立即可见）
- 一个 **Secret**（立即可见）

#### 设置您的 GitLab 环境变量

将 GitLab OAuth 凭据添加到您的部署平台的环境变量或本地的 `.env` 文件中

```bash [.env]
STUDIO_GITLAB_APPLICATION_ID=<your_gitlab_application_id>
STUDIO_GITLAB_CLIENT_SECRET=<your_gitlab_secret>
# 可选：授权电子邮件地址的逗号分隔列表，用于额外的访问控制
# STUDIO_GITLAB_MODERATORS=admin@example.com,editor@example.com
```
::

### Google

要使用 Google 作为您的身份验证提供商，您需要创建一个 Google OAuth 应用程序。

::prose-steps{level="4"}
#### 导航到 Google Cloud 控制台

转到 [Google Cloud 控制台](https://console.cloud.google.com/) 并选择或创建一个项目，然后导航到 **APIs & Services → Credentials**。

#### 创建 OAuth 应用程序

点击 **Create Credentials** 和 **OAuth client ID**，然后选择 **Web application** 作为应用程序类型。

填写必填字段：

- **Name**: 您的应用程序名称
- **Authorized redirect URIs**: `https://yourdomain.com/__nuxt_studio/auth/google`

  :::note
  如果您想在本地尝试 studio，请添加您的本地 URL 作为重定向 URI：`http://localhost:3000/__nuxt_studio/auth/google`
  :::

创建 OAuth 客户端后，您将收到：

- 一个 **Client ID**
- 一个 **Client Secret**

  :::warning
  不要忘记保存它们。
  :::

#### 创建个人访问令牌

  :::tabs
    ::::tabs-item{icon="i-lucide-github" label="GitHub"}
    为您的特定存储库在 [GitHub 设置 → 个人访问令牌](https://github.com/settings/personal-access-tokens/new) 上创建一个 **细粒度 GitHub 个人访问令牌**。

    填写必填字段：

    - **Token name**: 您的应用程序名称
    - **Resource owner**: 存储库所属的 GitHub 组织（或用户）
    - **Repository access**: 选择 **Only select repositories** 并选择您的存储库
    - **Permissions**: 点击 **Add permission** 并选择 **Contents** 然后将访问权限更新为 **Read and write**
    ::::

    ::::tabs-item{icon="i-lucide-gitlab" label="GitLab"}
    从 GitLab 的 **用户设置 → 个人访问令牌**（或适用的组/组织设置）创建 GitLab 个人访问令牌。

    推荐配置：

    - **Name**: 您的应用程序名称
    - **Expiration date**: 根据您的安全策略设置（GitLab 默认为 365 天，大多数实例上不允许设置永不过期的令牌） :note[请参阅 GitLab 关于过期限制的指导。] (<https://docs.gitlab.com/user/profile/personal_access_tokens/>)
    - **Scopes**: `api`（读取/写入存储库内容所需）

    复制生成的令牌；您将无法再次看到它。
    ::::
  :::

  :::warning
  Google OAuth 仅用于身份验证。Git 个人访问令牌（`STUDIO_GITHUB_TOKEN` 或 `STUDIO_GITLAB_TOKEN`）是向您的存储库推送更改所必需的。
  :::

#### 设置您的 Google 环境变量

将 **Google OAuth 凭据**和您的 Git 提供商的**个人访问令牌**添加到您的部署平台的环境变量或本地的 `.env` 文件中。不要忘记还使用 `STUDIO_GITHUB_MODERATORS` 变量将允许使用 Google 连接的用户加入白名单。

  :::tabs
    ::::tabs-item{icon="i-lucide-github" label="GitHub"}
    ```bash [.env.github]
    STUDIO_GOOGLE_CLIENT_ID=<your_google_client_id>
    STUDIO_GOOGLE_CLIENT_SECRET=<your_google_client_secret>
    STUDIO_GITHUB_TOKEN=<your_github_personal_access_token>
    STUDIO_GOOGLE_MODERATORS=admin@example.com,editor@example.com
    ```
    ::::

    ::::tabs-item{icon="i-lucide-gitlab" label="GitLab"}
    ```bash [.env.gitlab]
    STUDIO_GOOGLE_CLIENT_ID=<your_google_client_id>
    STUDIO_GOOGLE_CLIENT_SECRET=<your_google_client_secret>
    STUDIO_GITLAB_TOKEN=<your_gitlab_personal_access_token>
    STUDIO_GOOGLE_MODERATORS=admin@example.com,editor@example.com
    ```
    ::::
  :::

  :::warning
  `STUDIO_GOOGLE_MODERATORS` 环境变量是**必需的**，必须包含允许访问 Studio 的电子邮件地址的逗号分隔列表。只有拥有这些电子邮件地址的用户才能进行身份验证。
  :::
::

::tip
就是这样！一旦部署并设置了适当的凭据作为环境变量。Studio 将可以从您的生产实例访问。只需登录 `/_studio`（或您配置的路由）即可开始编辑和发布内容。
::

## 高级选项

### 使用管理员进行访问控制

您可以通过定义 `STUDIO_{PROVIDER}_MODERATORS` 环境变量的授权用户白名单来可选地限制对 Studio 的访问。这适用于所有 OAuth 提供商（GitHub、GitLab 和 Google）。

::note
对于 Google OAuth，管理员是必需的；对于 GitHub 或 GitLab，管理员是可选的。
::

```bash [.env]
STUDIO_GITHUB_MODERATORS=admin@example.com,editor@example.com,content-manager@example.com
STUDIO_GITLAB_MODERATORS=admin@example.com,editor@example.com,content-manager@example.com
STUDIO_GOOGLE_MODERATORS=admin@example.com,editor@example.com,content-manager@example.com
```

管理员列表应该是电子邮件地址的逗号分隔列表。只有使用与这些电子邮件地址匹配的账户登录的用户才会被授予 Studio 的访问权限。

#### 按提供商划分的行为

- **GitHub & GitLab**: 如果未设置 `STUDIO_{PROVIDER}_MODERATORS` 或为空，所有能够通过您的 OAuth 应用程序进行身份验证的用户都将拥有 Studio 的访问权限。白名单是**可选的**。OAuth 范围将用于写入访问，防止任何未经允许的用户向您的存储库推送更改。
- **Google OAuth**: `STUDIO_GOOGLE_MODERATORS` 环境变量是**必需的**。没有它，当使用 Google OAuth 时，没有人能够访问 Studio。

### 自定义重定向 URL

默认情况下，Studio 使用您的部署 URL 作为 OAuth 重定向 URL。如果您需要自定义它，可以指定自定义重定向 URL：

```bash [.env]
# 使用 GitHub 提供商
STUDIO_GITHUB_REDIRECT_URL=https://custom-domain.com/__nuxt_studio/auth/github

# 使用 GitLab 提供商
STUDIO_GITLAB_REDIRECT_URL=https://custom-domain.com/__nuxt_studio/auth/gitlab

# 使用 Google 提供商
STUDIO_GOOGLE_REDIRECT_URL=https://custom-domain.com/__nuxt_studio/auth/google
```

::note
当您需要通过特定端点处理 OAuth 回调时，这很有用。
::

## 使用暂存/预览分支

默认情况下，Studio 将更改提交到您配置中指定的分支（通常是 `main`）。但是，您可以配置 Studio 改为使用暂存或预览分支。

当您想要在合并到生产环境之前在预览环境中审查更改时，这很有用。您目前可以从 GitHub 手理拉取请求，但自动 PR 创建包含在我们的路线图中，并将在未来版本中实现。

::prose-steps
### 配置

更新您的 `nuxt.config.ts` 以目标您的暂存分支。

  :::tip
  您可以使用环境变量来管理不同环境的多个分支。
  :::

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  studio: {
    repository: {
      owner: 'your-username',
      repo: 'your-repo',
      branch: PROCESS.ENV.STUDIO_BRANCH_NAME, // 目标您的暂存分支而不是 main
    }
  }
})
```

### 部署

配置您的托管平台以将暂存分支部署到预览 URL（例如，`staging.yourdomain.com`）。

### 创建单独的 OAuth 应用（基于您的 Git 提供商）

为您的暂存环境创建一个新的 OAuth 应用，并使用您的暂存 URL 作为回调 URL。

### 设置环境变量

使用暂存 OAuth 凭据配置您的暂存部署环境变量。

```bash [.env.staging]
STUDIO_GITHUB_CLIENT_ID=<your_staging_github_client_id>
STUDIO_GITHUB_CLIENT_SECRET=<your_staging_github_client_secret>
STUDIO_GITHUB_BRANCH_NAME=<your_staging_branch_name>
```

### 在暂存上访问 Studio

导航到 `https://staging.yourdomain.com/_studio` 以编辑内容。所有提交都将推送到您配置的暂存分支。

### 合并到生产环境

一旦您对暂存分支上的更改感到满意，请在 GitHub 上从您的暂存分支创建一个拉取请求到您的 main 分支以部署到生产环境。

  :::note
  **拉取请求自动化即将推出**

  :br

  从 Studio 自动创建拉取请求计划在未来的版本中实现。目前，您需要在 GitHub 上手动创建 PR 以将暂存更改合并到您的 main 分支。
  ::
::
